<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Inquéritos — Lista</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px 10px; border: 1px solid #ddd; text-align: left; }
    th { background: #f2f2f2; }
    form.inline { display: inline; margin: 0; }
    .flash { padding: 10px; margin-bottom: 12px; border-radius: 4px; }
    .flash-danger { background:#f8d7da; color:#842029; }
    .flash-success { background:#d1e7dd; color:#0f5132; }
    .flash-warning { background:#fff3cd; color:#664d03; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
    .small-muted { color:#666; font-size:0.9em; }
    .actions a { margin-right:8px; }
    .form-row { display:flex; gap:8px; align-items:end; flex-wrap:wrap; }
    .form-row label { font-size:0.9em; }
    .form-row input[type="text"], .form-row input[type="number"], .form-row input[type="date"] { padding:6px; }
    .btn { padding:6px 10px; border:none; background:#0d6efd; color:white; cursor:pointer; border-radius:4px; }
    .btn-secondary { background:#6c757d; }
    .btn-danger { background:#dc3545; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Inquéritos</h1>
    <div class="actions">
      <a href="{{ url_for('concluir_mes') }}">Inquéritos a concluir (mês)</a>
      |
      <a href="{{ url_for('importar_massa') }}">Importação em massa</a>
      |
      <a href="{{ url_for('relatorios') }}">Relatórios Concluídos</a>
      |
      <a href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="flash {% if category == 'danger' %}flash-danger{% elif category == 'success' %}flash-success{% else %}flash-warning{% endif %}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <section>
    <h2>Adicionar novo inquérito</h2>
    <form action="{{ url_for('adicionar') }}" method="post" class="form-row">
      <div>
        <label for="num_controle">Nº Controle</label><br>
        <input type="text" id="num_controle" name="num_controle" required>
      </div>

      <div>
        <label for="num_eletronico">Nº Eletrônico</label><br>
        <input type="text" id="num_eletronico" name="num_eletronico" required>
      </div>

      <div>
        <label for="ano">Ano</label><br>
        <input type="number" id="ano" name="ano" min="1900" max="2100" required>
      </div>

      <div>
        <label for="num_processo">Nº Processo</label><br>
        <input type="text" id="num_processo" name="num_processo">
      </div>

      <div>
        <label for="data_conclusao">Data Conclusão</label><br>
        <input type="date" id="data_conclusao" name="data_conclusao" placeholder="2025-12-18">
      </div>

      <div>
        <button class="btn" type="submit">Adicionar</button>
      </div>
    </form>
    <p class="small-muted">Obs.: A data é inserida no formato <strong>AAAA-MM-DD</strong> (padrão do campo de calendário).</p>
  </section>

  <hr>

  <p><strong>Total de registros:</strong> {{ total }}</p>

  <table>
    <thead>
      <tr>
        <th>Concluir</th>
        <th><a href="{{ url_for('index', ordem='id', dir='ASC' if dir_atual=='DESC' else 'DESC') }}">ID</a></th>
        <th><a href="{{ url_for('index', ordem='num_controle', dir='ASC' if dir_atual=='DESC' else 'DESC') }}">Nº Controle</a></th>
        <th><a href="{{ url_for('index', ordem='num_eletronico', dir='ASC' if dir_atual=='DESC' else 'DESC') }}">Nº Eletrônico</a></th>
        <th><a href="{{ url_for('index', ordem='ano', dir='ASC' if dir_atual=='DESC' else 'DESC') }}">Ano</a></th>
        <th>Nº Processo</th>
        <th><a href="{{ url_for('index', ordem='data_conclusao', dir='ASC' if dir_atual=='DESC' else 'DESC') }}">Data Conclusão</a></th>
        <th>Ações</th>
      </tr>
    </thead>

    <tbody>
      {% for row in inqueritos %}
      <tr>
        <td style="text-align:center;">
          <input type="checkbox"
                 {% if row[10] == 1 %}checked{% endif %}
                 onchange="(function(){ var v = this.checked ? 1 : 0; window.location.href='{{ url_for('rota_marcar_concluir', id=row[0]) }}?v='+v; }).call(this)">
        </td>

        <td>{{ row[0] }}</td>
        <td>{{ row[1] or '' }}</td>
        <td>{{ row[2] or '' }}</td>
        <td>{{ row[3] or '' }}</td>
        <td>{{ row[4] or '' }}</td>
        <td>{{ row[5].strftime('%d/%m/%Y') if row[5] else '' }}</td>

        <td>
          <a href="{{ url_for('editar', id=row[0]) }}">Editar</a>
          |
          <a href="{{ url_for('deletar', id=row[0]) }}" onclick="return confirm('Confirma exclusão?')">Excluir</a>
          {% if row[10] == 1 %}
            | <a href="{{ url_for('concluir_mes') }}">Concluir (lista)</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <footer style="margin-top:18px;">
    <p class="small-muted">Sistema de controle de inquéritos — Gere relatórios a partir da aba de inquéritos concluídos.</p>
  </footer>

  </body>
</html>