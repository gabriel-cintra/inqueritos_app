<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Relat√≥rios de Inqu√©ritos Conclu√≠dos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .filter-row { display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px; }
    </style>
</head>

<body class="bg-light">

<div class="container py-4">

    <h2 class="mb-4">üìã Relat√≥rios de Inqu√©ritos Conclu√≠dos</h2>
    
    <div class="card p-3 mb-4">
        <form method="GET" action="{{ url_for('relatorios') }}" class="filter-row">
            
            <div class="form-group">
                <label for="mes">M√™s de Refer√™ncia:</label>
                <select name="mes" id="mes" class="form-select">
                    {% for num, nome in meses_do_ano %}
                        <option value="{{ num }}" {% if num == mes_atual %}selected{% endif %}>
                            {{ nome }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="ano">Ano de Refer√™ncia:</label>
                <select name="ano" id="ano" class="form-select">
                    {% for ano in anos_disponiveis | reverse %}
                        <option value="{{ ano }}" {% if ano == ano_atual %}selected{% endif %}>
                            {{ ano }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Filtrar</button>
        </form>
    </div>

    <h3>Resultados para {{ meses_do_ano[mes_atual - 1][1] }} de {{ ano_atual }} ({{ inqueritos|length }} registros)</h3>

    {% if inqueritos and inqueritos|length > 0 %}

    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
    <tr>
        <th>N¬∫ Eletr√¥nico</th>
        <th>N¬∫ Controle</th>
        <th>N¬∫ Processo</th>
        <th>Data Conclus√£o</th>
        <th>Data de Relato (Registro)</th>
        <th style="width: 150px;">A√ß√µes</th> </tr>
</thead>
<tbody>
  {% for row in inqueritos %}
  <tr>
    <td>{{ row[1] or '' }}</td> <td>{{ row[5] or '' }}</td> <td>{{ row[2] or '' }}</td> <td>{{ row[3].strftime('%d/%m/%Y') if row[3] else '' }}</td> <td>{{ row[6].strftime('%d/%m/%Y %H:%M') if row[6] else '' }}</td> <td>
        <form action="{{ url_for('rota_desfazer_relato', id=row[0]) }}" method="get"
              onsubmit="return confirm('Confirma que deseja REMOVER este registro dos relat√≥rios e RESTAUR√Å-LO na lista principal?')">
            <button type="submit" class="btn btn-danger btn-sm w-100">
                Apagar e Restaurar
            </button>
        </form>
    </td>
  </tr>
  {% endfor %}
</tbody>
      </table>
    </div>

    {% else %}
      <div class="alert alert-info">N√£o h√° inqu√©ritos relatados neste per√≠odo.</div>
    {% endif %}

    <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">‚Üê Voltar para a Lista Principal</a>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>